# This file was autogenerated by actions.nix. Do not edit it manually.
# To make changes, edit the workflow definition in your flake's actions-nix configuration
# (typically under flake.actions-nix.workflows.".github/workflows/regenerate-workflows.yaml") and run:
#   nix run .#render-workflows
# Or commit to trigger the pre-commit hook if enabled.
jobs:
  regenerate:
    if: github.actor == 'renovate[bot]' || github.event_name == 'workflow_dispatch'
    runs-on: ubuntu-latest
    steps:
    - id: app-token
      name: Generate App Token
      uses: actions/create-github-app-token@29824e69f54612133e76f7eaac726eef6c875baf
      with:
        app-id: ${{ secrets.APP_ID }}
        private-key: ${{ secrets.APP_PRIVATE_KEY }}
    - name: Checkout
      uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd
      with:
        fetch-depth: 2
        ref: ${{ github.head_ref || github.ref_name }}
        token: ${{ steps.app-token.outputs.token }}
    - name: Install Nix
      uses: DeterminateSystems/nix-installer-action@main
      with:
        diagnostic-endpoint: ''
        extra-conf: |-
          accept-flake-config = true
          always-allow-substitutes = true
          builders-use-substitutes = true
          max-jobs = auto
    - name: Setup Nix cache
      uses: DeterminateSystems/magic-nix-cache-action@main
      with:
        diagnostic-endpoint: ''
    - name: Regenerate workflows
      run: nix run .#render-workflows
    - name: Amend commit with regenerated workflows
      run: |-
        git config user.name "mrsom3body-bot[bot]"
        git config user.email "261862837+MrSom3body-Bot[bot]@users.noreply.github.com"
        git add .github/workflows/
        git diff --staged --quiet || git commit --amend --no-edit
        git push --force-with-lease
    - env:
        GH_TOKEN: ${{ steps.app-token.outputs.token }}
      name: Auto Merge PR (${{ github.event.pull_request.number }})
      run: |-
        if [ -n "${{ github.event.pull_request.number }}" ]; then
          gh pr merge --auto --rebase ${{ github.event.pull_request.number }}
        fi
name: Regenerate workflows
'on':
  pull_request:
    paths:
    - modules/flake/actions.nix
    - flake.lock
  workflow_dispatch: {}
permissions:
  contents: write
  pull-requests: write
