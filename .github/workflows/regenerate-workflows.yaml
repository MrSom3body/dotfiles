# This file was autogenerated by actions.nix. Do not edit it manually.
# To make changes, edit the workflow definition in your flake's actions-nix configuration
# (typically under flake.actions-nix.workflows.".github/workflows/regenerate-workflows.yaml") and run:
#   nix run .#render-workflows
# Or commit to trigger the pre-commit hook if enabled.
jobs:
  regenerate:
    if: github.actor == 'renovate[bot]' || github.event_name == 'workflow_dispatch'
    runs-on: ubuntu-latest
    steps:
    - id: app-token
      name: Generate App Token
      uses: actions/create-github-app-token@7e473efe3cb98aa54f8d4bac15400b15fad77d94
      with:
        app-id: ${{ secrets.APP_ID }}
        private-key: ${{ secrets.APP_PRIVATE_KEY }}
    - name: Checkout
      uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd
      with:
        fetch-depth: 2
        ref: ${{ github.head_ref || github.ref_name }}
        token: ${{ steps.app-token.outputs.token }}
    - name: Install Nix
      uses: cachix/install-nix-action@2126ae7fc54c9df00dd18f7f18754393182c73cd
      with:
        github_access_token: ${{ secrets.GITHUB_TOKEN }}
    - name: Setup Nix cache
      uses: nix-community/cache-nix-action@7df957e333c1e5da7721f60227dbba6d06080569
      with:
        gc-max-store-size-linux: 5G
        primary-key: nix-${{ runner.os }}-${{ hashFiles('**/*.nix', '**/flake.lock')
          }}
        purge: true
        purge-created: 0
        purge-last-accessed: 0
        purge-prefixes: nix-${{ runner.os }}-
        purge-primary-key: never
        restore-prefixes-first-match: nix-${{ runner.os }}-
    - name: Regenerate workflows
      run: nix run .#render-workflows
    - name: Format code
      run: nix fmt
    - name: Amend commit with regenerated workflows
      run: |-
        git config user.name "mrsom3body-bot[bot]"
        git config user.email "261862837+MrSom3body-Bot[bot]@users.noreply.github.com"
        git add .github/workflows/
        git diff --staged --quiet || git commit --amend --no-edit
        git push --force-with-lease
    - uses: peter-evans/enable-pull-request-automerge@a660677d5469627102a1c1e11409dd063606628d
      with:
        merge-method: rebase
        pull-request-number: ${{ github.event.pull_request.number }}
        token: ${{ steps.app-token.outputs.token }}
    timeout-minutes: 60
name: Regenerate workflows
'on':
  pull_request:
    paths:
    - modules/flake/actions.nix
    - flake.lock
  workflow_dispatch: {}
permissions:
  contents: write
  pull-requests: write
